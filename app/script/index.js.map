{"version":3,"sources":["index.coffee"],"names":[],"mappings":"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","file":"index.js","sourceRoot":"/source/","sourcesContent":["angular.module 'hahaki', []#, ($httpProvider) ->\n.constant 'IMG_RE', /\\.(?:jpe?g|png|gif)$/\n.filter 'size', ->\n  (tabs) -> (_.filter tabs, (tab) -> tab.remove is false).length\n.filter 'base64', ->\n  (tab) ->\n    \"data:image/#{tab.extname};base64,#{tab.img}\" if tab?\n.filter 'allValid', ->\n  (forms) ->\n    (_.filter forms, (form) -> not form.$valid).length is 0\n.factory 'base64', ($window, $http, $q) ->\n  {\n    get: (url) ->\n      $q (resolve, reject) ->\n        $http.get url, {responseType: 'arraybuffer'}\n        .success (data, a) ->\n          uInt8Array = new Uint8Array data\n          i = uInt8Array.length\n          binaryString = new Array i\n          while (i--)\n            binaryString[i] = String.fromCharCode(uInt8Array[i])\n          data = binaryString.join ''\n          base64 = $window.btoa(data)\n          resolve base64\n        .error ->\n          reject()\n  }\n\n.controller 'HahakiController', ($scope, $q, base64, IMG_RE) ->\n  hahaki = @\n  hahaki.foldername = \"images\"\n  hahaki.loaded = false\n  hahaki.tabs = []\n  hahaki.fullView = null\n  hahaki.forms = []\n  chrome.tabs.query {currentWindow: true}, (tabs) ->\n    imgTabs = _.chain tabs\n      .filter (tab) -> IMG_RE.test tab.url\n      .uniq (tab) -> tab.title\n      .map (tab) -> _.pick tab, ['id', 'title', 'url']\n      .value()\n\n    promises = _.map imgTabs, (tab) -> base64.get tab.url\n    $q.all promises\n    .then (base64List) ->\n      hahaki.tabs = _.map imgTabs, (tab, i) ->\n        pickedName = tab.title.match /^([^.]+)\\.(jpe?g|png|gif)/\n        {\n          id: tab.id\n          path:\n            filename: pickedName[1]\n            extname: pickedName[2]\n          img: base64List[i]\n          remove: false\n          enterWithRemove: false\n        }\n      hahaki.loaded = true\n\n  hahaki.fullscreen = (idx) ->\n    hahaki.fullView = @tabs[idx]\n  hahaki.closeFullView = ->\n    hahaki.fullView = null\n\n  hahaki.download = (foldername, tabs, isClose, size, isValid) ->\n    if size  > 0 and isValid\n      zip = new JSZip()\n      folder = zip.folder (foldername or 'images')\n      _.each tabs, (tab, i) ->\n        if tab.remove is false\n          folder.file(\n            \"#{tab.path.filename}.#{tab.path.extname}\"\n            tab.img\n            {base64: true}\n          )\n      images = zip.generate {type: 'blob'}\n      saveAs images, \"#{foldername}.zip\"\n\n      if isClose\n        delIds = _.pluck hahaki.tabs, 'id'\n        chrome.tabs.remove delIds, ->\n          hahaki.tabs = []\n\n\n  hahaki.remove = (idx) ->\n    removeTab = hahaki.tabs[idx]\n    removeTab.remove = true\n  hahaki.undo = (idx) ->\n    undoTab = hahaki.tabs[idx]\n    undoTab.remove = false\n\n  hahaki\n\n.directive 'card', ->\n  restrict: 'A'\n  templateUrl: 'component/card.html'\n\n.directive 'cardImg', ->\n  restrict: 'A'\n  link: (scope, elm, attrs) ->\n    elm.css 'backgroundImage', \"url(data:image/jpg;base64,#{attrs.cardImg})\"\n\n.directive 'uniq', ->\n  restrict: 'A'\n  scope: false\n  require: 'ngModel'\n  link: (scope, elm, attrs, ctrl) ->\n    scope.$parent.hahaki.forms.push ctrl\n    ctrl.$validators.uniq = (modelValue, viewValue) ->\n      tabs = _.chain scope.$parent.hahaki.tabs\n        .filter (tab) -> tab.id isnt scope.tab.id\n        .filter (tab) ->\n          tab.path.filename is viewValue\n        .value()\n      tabs.length is 0\n"]}